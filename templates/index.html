<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="../static/style.css">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–î–æ—Ä–æ–≥–∏ –†–æ—Å—Å–∏–∏</title>
</head>
<body>
    
    <section class = "header">
        <div class="container">
            <div class = "nav">
                <img class="logo" src="../static/img/logo.svg">
                <input class="search_input" type="text" name="search" placeholder="–í–≤–µ–¥–∏—Ç–µ –¥–ª—è –ø–æ–∏—Å–∫–∞" value="{{ request.args.get('search', '') }}">
            </div>
        </div>
    </section>

    <section class ="stuff_frame">
        <div class = "container">
            <h2>–°–æ—Ç—Ä—É–¥–Ω–∏–∫–∏</h2>
            <div class ="stuff_grid">
                {%if not stuff%}
                <h2>–î–∞–Ω–Ω—ã—Ö –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</h2>
                {% else %}
                {% for i in stuff%}
                    <div class="stuff_card">
                        <h4>{{i.name}}</h4>
                        <p>{{i.post}}</p>
                        <p>email</p>
                        <p>{{i.phone}}</p>
                        <div class="qr_btns">
                            <p>{{ i.bdate }}</p>
                            <!-- –§–æ—Ä–º–∞ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –¥–∞–Ω–Ω—ã—Ö –Ω–∞ —Å–µ—Ä–≤–µ—Ä -->
                            <form action="/generate_qr" method="GET">
                                <input type="hidden" name="name" value="{{ i.name }}">
                                <input type="hidden" name="email" value="{{ i.email }}">
                                <input type="hidden" name="phone" value="{{ i.phone }}">
                                <input type="hidden" name="position" value="{{ i.post }}">
                                <button type="submit">üéû</button>
                            </form>
                        </div>
                        <!-- –ú–µ—Å—Ç–æ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è QR-–∫–æ–¥–∞ -->
                        <div id="qr-{{ loop.index }}" class="qr-code" style="display:none;">
                            <img id="qr-img-{{ loop.index }}" src="" alt="QR-–∫–æ–¥">
                        </div>
                    </div>
            {% endfor %}
            {% endif %}
            </div>
        </div>
    </section>

        <div class = "container">
            <div class = "events_news_frame">
                <div class ="events_frame">

                    <h2>–ö–∞–ª–µ–Ω–¥–∞—Ä—å —Å–æ–±—ã—Ç–∏–π</h2>

                    <form method="POST" class = "calendar_frame">
                        <div class = "calendar_header">
                            <button type = "submit" name = "prev">‚¨Ö</button>
                            <h2>{{year}} {{month_name}}</h2>
                            <button type="submit" name="next">‚û°</button>
                        </div>
                        <input type="hidden" name="year" value="{{year}}">
                        <input type="hidden" name="month" value="{{month}}">

                        <table class="calendar_widget">
                            <thead>
                                <tr>
                                    <th>–ü–Ω</th>
                                    <th>–í—Ç</th>
                                    <th>–°—Ä</th>
                                    <th>–ß—Ç</th>
                                    <th>–ü—Ç</th>
                                    <th>–°–±</th>
                                    <th>–í—Å</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for week in calendar %}
                                <tr>
                                    {% for day in week %}
                                    {% if day != 0 %}
                                    {% set date_str = '{:04d}-{:02d}-{:02d}'.format(year, month, day) %}
                                                {% set is_today = (day == now.day and month == now.month and year == now.year) %}
                                                {% set is_non_working = date_str in non_working_days %}
                                                {% set event_count_today = event_count.get(datetime(year, month, day).date(), 0) %}
                                                <td id="{% if event_count_today >= 5 %}multiple-events{% elif event_count_today < 2 %}low-event{% else %}mid-event{% endif %}" 
                                                    class="{% if is_today %}current-day{% endif %} {% if is_non_working %}non-working-day{% endif %}">
                                                    {{ day }}
                                                </td>
                                    {%else%}
                                    <td></td>
                                    {%endif%}
                                    {%endfor%}
                                </tr>
                                {%endfor%}
                            </tbody>
                        </table>
                    </form>

                    <h2>–°–æ–±—ã—Ç–∏—è</h2>
                    {%if not events%}
                    <h2>–°–æ–±—ã—Ç–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</h2>
                    {%else%}
                    {%for i in events%}
                    <div class = "event_card">
                        <h4>{{i.name}}</h4>
                        <p>{{i.discription}}</p>
                        <div class="footer_events">
                            <button class='calebdar_btn'>üóì</button>
                            <p>{{i.ev_date}}</p>
                            <p>{{i.author_name}}</p>
                        </div>
                    </div>
                    {%endfor%}
                    {%endif%}
                </div>
                <div class ="news_frame">
                    <h2>–ù–æ–≤–æ—Å—Ç–∏</h2>
                </div>
            </div>        
        </div>
        <script>
            document.querySelector('.search_input').addEventListener('input', function() {
                const searchValue = this.value;
                const url = new URL(window.location.href);
                url.searchParams.set('search', searchValue);
                window.location.href = url.toString();
            });
        </script>
</body>
</html>
